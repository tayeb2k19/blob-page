<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>جارٍ التحويل إلى جلسة Blob…</title>
  <style>
    body{
      font-family: system-ui, "Segoe UI", Arial;
      display:flex;
      align-items:center;
      justify-content:center;
      min-height:100vh;
      margin:0;
      background:#0f172a;
      color:#e2e8f0;
    }
    .card{
      background:#111827;
      padding:20px 26px;
      border-radius:12px;
      text-align:center;
      box-shadow:0 8px 24px rgba(0,0,0,.35);
    }
    small{display:block;opacity:.75;margin-top:8px}
  </style>
</head>
<body>
  <div class="card">
    <h2>جاري فتح جلسة محلية (blob:)</h2>
    <p>إذا لم يحدث تحويل تلقائي، انتظر ثانية أو حمّل الصفحة مجددًا.</p>
    <small>لا يوجد أي تبادل بيانات خارجية — العملية تتم محليًا في متصفحك.</small>
  </div>

  <script>
    (function(){
      // محتوى الصفحة التي سيتم فتحها داخل جلسة blob
      const blobHtml = `<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>صفحة من Blob</title>
  <style>
    body{font-family:system-ui,Segoe UI,Arial;display:grid;place-items:center;min-height:100vh;background:#111827;color:#e2e8f0;margin:0}
    .wrap{max-width:720px;padding:24px;text-align:center}
    h1{margin:0 0 8px;color:#22c55e}
    p{line-height:1.6;color:#cbd5e1}
    code{background:#0b1220;color:#93c5fd;padding:.2em .4em;border-radius:6px}
  </style>
</head>
<body>
  <div class="wrap">
    <h1>✅ تم فتح الصفحة عبر <code>blob:</code></h1>
    <p>هذه الصفحة مولَّدة محليًا داخل متصفحك باستخدام <code>URL.createObjectURL</code>.</p>
    <p>الوقت الآن: <span id="now"></span></p>
    <script>
      document.getElementById('now').textContent = new Date().toLocaleString();
    <\/script>
  </div>
</body>
</html>`.trim();

      // إنشاء Blob وURL ثم الانتقال إليه فورًا
      try {
        const blob = new Blob([blobHtml], { type: 'text/html' });
        const url = URL.createObjectURL(blob);

        // فتح الـ blob في نفس النافذة (تغيير العنوان حقيقي)
        // استخدم window.location.replace(url) إذا تبي تمنع الرجوع للصفحة الحالية
        window.location.href = url;

        // تنظيف الرابط المؤقت بعد 15 ثانية (نظريًا — يمكن أن يفشل التنظيف إذا تم التنقل بعيدًا جدًا)
        setTimeout(() => {
          try { URL.revokeObjectURL(url); } catch(e) { /* تجاهل أخطاء التنظيف */ }
        }, 15000);
      } catch (err) {
        console.error('خطأ أثناء إنشاء جلسة blob:', err);
      }
    })();
  </script>
</body>
</html>
